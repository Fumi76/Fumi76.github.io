<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>
<body>
<div style="width: 100%;" align="center">
<div style="margin-top: 20px; width: 80%; text-align: left;">

    <h1><a href="/">Auroraメモ</a></h1>
    <h2>DBクラスター</h2>
<ul>
    <li>DBクラスターは1つ以上のDBインスタンスとそのデータを管理する1つのクラスターボリュームから構成される。計算（DBエンジン?)とストレージを分割している。</li>
    <li>クラスターボリュームは複数のAZにまたがった仮想的なDBストレージボリュームであり、個々のAZそれぞれがDBクラスターのデータのコピーを1つずつ持っている。</li>
    <li>DBインスタンスの種類にはプライマリDBインスタンスとレプリカの2つがある</li>
</ul>

    <h3>プライマリDBインスタンス</h3>
    <ul>
        <li>プライマリDBインスタンスはDBクラスターに1つだけある</li>
        <li>読み書き処理とクラスターボリュームへのデータ操作すべてを担当する</li>
    </ul>

    <h3>レプリカ</h3>
    <ul>
        <li>レプリカは読み取り処理のみサポート。読み取り処理の負荷分散に使用できる（レプリカラグに注意）</li>
        <li>最大15個まで追加できる</li>
        <li>プライマリDBインスタンスが使用不能になった場合に、Auroraは自動的にレプリカにフェイルオーバーする。</li>
        <li>レプリカをプライマリDBインスタンスと別のAZに配置しておくことでプライマリDBインスタンスのいるAZの障害時にも対応できる。</li>
        <li>レプリカにフェイルオーバーの優先順位を設定できる</li>
</ul>

    <h3>クラスターボリューム</h3>
    <ul>
        <li>SSDを使用</li>
        <li>1つのリージョン内の複数AZにデータを自動的に複製する。データの堅牢性、DBの可用性が高まる</li>
        <li>複製の数はクラスタのDBインスタンスの数とは関係しない</li>
        <li>DBインスタンスが1つであっても、(その数とは関係なく)基盤となるストレージボリュームは複数のAZにまたがって配置されている複数のストレージノードから構成される</li>
        <li>AuroraはDBボリュームを10GBのセグメントに分割して複数のディスクに分散して格納する。個々の10GBのかたまりは3つのAZに6つ複製される。</li>
        <li>上記により、Auroraはデータの書き込みについては2つの複製の喪失まで耐えることができ、データの読み込みについては3つの複製の喪失まで耐えることができる。(ディスク障害への耐性)</li>
        <li>Auroraは自己修復を行う。データブロックやディスクは定期的にエラーがないか検査され、あれば自動的に修復される</li>
        <li>クラスターボリュームにはユーザーのすべてのデータ、スキーマオブジェクト、システムテーブルやバイナリログといった内部的なメタデータが格納される。Auroraでは例えば、テーブル、インデクス、BLOB、ストアドプロシージャなどを格納している</li>
        <li>実際のデータ量の増加に応じて自動的に拡張される</li>
        <li>最大64TBまで可能。テーブルの最大サイズも同じ。</li>
        <li>課金は実際に確保している領域に応じてだが、high water mark式のため、データを削除しても確保している領域は減らないので注意</li>
    </ul>


</div>
</div>
</body>
</html>