<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
</head>
<body>
<div style="width: 100%;" align="center">
    <div style="margin-top: 20px; width: 80%; text-align: left;">

        <h1>Auroraメモ</h1>
        <h2>Auroraの自動化機能</h2>
        <ul>
            <li>ストレージの自動修復</li>
            <li>キャッシュを自動的に最適に「暖気」</li>
            <li>クラッシュからのリカバリ</li>
        </ul>

        <h3>ストレージの自動修復</h3>
        <ul>
            <li>Auroraはクラスターボリュームを構成するディスクボリュームの障害を自動的に検知する</li>
            <li>ディスクボリュームのセグメントに障害が起きたとき、Auroraはすぐにそのセグメントを修復する。修復するときに、そのセグメントのデータが最新状態に一致するように、他のボリュームのデータを使用する。</li>
            <li>上記によりデータの喪失を回避し、ディスク障害からの復旧のためにポイントインタイムのリストアの必要性を減少させている</li>
        </ul>

        <h3>キャッシュを自動的に最適に「暖気」</h3>
        <ul>
            <li>シャットダウン後や再起動後のDB起動時に、Auroraはバッファプールキャッシュを「暖気」する。Auroraは、インメモリのページキャッシュに保持されている使用頻度の高いクエリが使用するページをバッファプールに事前に読み込む。</li>
            <li>バッファプールの「暖気」が不要になり、パフォーマンス上の利点になる</li>
            <li>AuroraのページキャッシュはDBとは別のプロセス(のメモリ)で管理されていて、それによりページキャッシュはDBとは関係なく存続している</li>
            <li>DB障害後の再起動時には、存続しているページキャッシュの最新の状態を使用してバッファプールは「暖気」されるようになっている</li>
        </ul>

        <h3>クラッシュからのリカバリ</h3>
        <ul>
            <li>Auroraはバイナリログなしでもクラッシュから即座にリカバリし、稼働を続けられるように設計されている</li>
            <li>Auroraは複数のスレッドで並行して非同期的にクラッシュからのリカバリを行い、クラッシュ後すぐに再開し使用可能になるようにしている</li>
            <li>Auroraでは、DBのクラッシュ後のリカバリとして最後のチェックポイントからのREDOログを適用する必要はない(別の仕組みになっている)</li>
            <li>Auroraではほとんどの場合、DBが再度起動するまでの時間は60秒以内になる</li>
            <li>AuroraではDBのプロセスからバッファキャッシュが移されていて、DB再起動時にすぐに使用できる状態になっている。これによりキャッシュが載るまでの間、性能が低下するのを避けることができる</li>
            <li>クラッシュからのリカバリについては<a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Managing.Backups.html#Aurora.Managing.FaultTolerance">このページ</a>も参照</li>
            <li>
                Aurora MySQLでのバイナリログの使用とクラッシュからのリカバリにおける考慮事項
                <ul>
                    <li>バイナリログを使用すると、クラッシュ後にバイナリログからリカバリすることをDBインスタンスに強制することになるので、リカバリの時間に直接的に影響する</li>
                    <li>使用するバイナリログの種類によってログの量と情報量が異なる。binlog_formatパラメータの指定に応じてログのデータ量が異なる。
                        <ul>
                            <li>ROW  最も多い</li>
                            <li>STATEMENT  最も少ない</li>
                            <li>MIXED  中間。データ整合性とパフォーマンスのバランスが最も良い</li>
                        </ul>
                        リカバリ時にDBインスタンスが処理する必要があるデータが多ければ多いほど、リカバリ時間は増加する
                    </li>
                    <li>AuroraはDBクラスター内でのデータのレプリケーション、ポイントインタイムのリストア(PITR)にバイナリログを必要としない（つまりバイナリログは使用しなくても問題ないということか？）</li>
                    <li>外部へのレプリケーションや外部へのバイナリログストリームのためにバイナリログを必要としないのであれば、binlog_formatパラメータにはOFFを指定して無効化しておくことを推奨。それによりリカバリ時間が減少する</li>
                    <li>Auroraのバイナリログとレプリケーションについては<a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html">このページ</a>も参照</li>
                </ul>
            </li>
        </ul>

    </div>
</div>
</body>
</html>